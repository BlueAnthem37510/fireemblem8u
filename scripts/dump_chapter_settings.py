#!/usr/bin/env python3

import json
import tool

table_address = 0x8B0890
table_entries = 79

chapters = []

weather = ('fine', 'snow', 'snowstorm', '3', 'rain', 'flames', 'sandstorm', 'clouds')
goal = ('seize', 'defeat_all', 'defense', 'defeat_boss', 'special')

with open('../baserom.gba', 'rb') as f_rom:
    f_rom.seek(table_address)
    for i in range(table_entries):
        chapter = {}
        chapter['internalName'] = tool.read_pointer_here(f_rom)
        chapter['mapObj1Id'] = tool.read_u8_here(f_rom)
        chapter['mapObj2Id'] = tool.read_u8_here(f_rom)
        chapter['mapPaletteId'] = tool.read_u8_here(f_rom)
        chapter['mapTileConfigId'] = tool.read_u8_here(f_rom)
        chapter['mapMainLayerId'] = tool.read_u8_here(f_rom)
        chapter['mapTileAnim1Id'] = tool.read_u8_here(f_rom)
        chapter['mapTileAnim2Id'] = tool.read_u8_here(f_rom)
        chapter['mapChangeLayerId'] = tool.read_u8_here(f_rom)
        chapter['initialFogLevel'] = tool.read_u8_here(f_rom)
        chapter['hasPrepScreen'] = tool.read_bool8_here(f_rom)
        chapter['chapTitleId'] = tool.read_u8_here(f_rom)
        chapter['chapTitleIdInHectorStory'] = tool.read_u8_here(f_rom)
        chapter['initialPosX'] = tool.read_u8_here(f_rom)
        chapter['initialPosY'] = tool.read_u8_here(f_rom)
        chapter['initialWeather'] = weather[tool.read_u8_here(f_rom)]
        chapter['battleTileSet'] = tool.read_u8_here(f_rom)
        level = tool.read_u16_here(f_rom)
        chapter['easyModeLevelMalus'] = level & 0xf
        chapter['difficultModeLevelBonus'] = (level >> 4) & 0xf
        chapter['normalModeLevelMalus'] = (level >> 8) & 0xf
        chapter['mapBgmIdBluePhase'] = tool.read_u16_here(f_rom)
        chapter['mapBgmIdRedPhase'] = tool.read_u16_here(f_rom)
        chapter['mapBgmIdGreenPhase'] = tool.read_u16_here(f_rom)
        chapter['mapBgmIdBluePhaseInHectorStory'] = tool.read_u16_here(f_rom)
        chapter['mapBgmIdRedPhaseInHectorStory'] = tool.read_u16_here(f_rom)
        chapter['mapBgmIdGreenPhaseInHectorStory'] = tool.read_u16_here(f_rom)
        chapter['mapBgmIdBlueGreenPhaseAlt'] = tool.read_u16_here(f_rom)
        chapter['mapBgmIdRedPhaseAlt'] = tool.read_u16_here(f_rom)
        chapter['mapPrologueBgmIdInLynStory'] = tool.read_u16_here(f_rom)
        chapter['mapPrologueBgmId'] = tool.read_u16_here(f_rom)
        chapter['mapPrologueBgmIdInHectorStory'] = tool.read_u16_here(f_rom)
        chapter['mapCrackedWallHeath'] = tool.read_u8_here(f_rom)
        chapter['turnsForTacticsRankAInEliwoodStoryNormal'] = tool.read_u8_here(f_rom)
        chapter['turnsForTacticsRankAInEliwoodStoryHard'] = tool.read_u8_here(f_rom)
        chapter['turnsForTacticsRankAInHectorStoryNormal'] = tool.read_u8_here(f_rom)
        chapter['turnsForTacticsRankAInHectorStoryHard'] = tool.read_u8_here(f_rom)
        chapter['turnsForTacticsRankBInEliwoodStoryNormal'] = tool.read_u8_here(f_rom)
        chapter['turnsForTacticsRankBInEliwoodStoryHard'] = tool.read_u8_here(f_rom)
        chapter['turnsForTacticsRankBInHectorStoryNormal'] = tool.read_u8_here(f_rom)
        chapter['turnsForTacticsRankBInHectorStoryHard'] = tool.read_u8_here(f_rom)
        chapter['turnsForTacticsRankCInEliwoodStoryNormal'] = tool.read_u8_here(f_rom)
        chapter['turnsForTacticsRankCInEliwoodStoryHard'] = tool.read_u8_here(f_rom)
        chapter['turnsForTacticsRankCInHectorStoryNormal'] = tool.read_u8_here(f_rom)
        chapter['turnsForTacticsRankCInHectorStoryHard'] = tool.read_u8_here(f_rom)
        chapter['turnsForTacticsRankDInEliwoodStoryNormal'] = tool.read_u8_here(f_rom)
        chapter['turnsForTacticsRankDInEliwoodStoryHard'] = tool.read_u8_here(f_rom)
        chapter['turnsForTacticsRankDInHectorStoryNormal'] = tool.read_u8_here(f_rom)
        chapter['turnsForTacticsRankDInHectorStoryHard'] = tool.read_u8_here(f_rom)
        chapter['unk3D'] = tool.read_u8_here(f_rom)
        chapter['gainedExpForExpRankAInEliwoodStoryNormal'] = tool.read_u16_here(f_rom)
        chapter['gainedExpForExpRankAInEliwoodStoryHard'] = tool.read_u16_here(f_rom)
        chapter['gainedExpForExpRankAInHectorStoryNormal'] = tool.read_u16_here(f_rom)
        chapter['gainedExpForExpRankAInHectorStoryHard'] = tool.read_u16_here(f_rom)
        chapter['gainedExpForExpRankBInEliwoodStoryNormal'] = tool.read_u16_here(f_rom)
        chapter['gainedExpForExpRankBInEliwoodStoryHard'] = tool.read_u16_here(f_rom)
        chapter['gainedExpForExpRankBInHectorStoryNormal'] = tool.read_u16_here(f_rom)
        chapter['gainedExpForExpRankBInHectorStoryHard'] = tool.read_u16_here(f_rom)
        chapter['gainedExpForExpRankCInEliwoodStoryNormal'] = tool.read_u16_here(f_rom)
        chapter['gainedExpForExpRankCInEliwoodStoryHard'] = tool.read_u16_here(f_rom)
        chapter['gainedExpForExpRankCInHectorStoryNormal'] = tool.read_u16_here(f_rom)
        chapter['gainedExpForExpRankCInHectorStoryHard'] = tool.read_u16_here(f_rom)
        chapter['gainedExpForExpRankDInEliwoodStoryNormal'] = tool.read_u16_here(f_rom)
        chapter['gainedExpForExpRankDInEliwoodStoryHard'] = tool.read_u16_here(f_rom)
        chapter['gainedExpForExpRankDInHectorStoryNormal'] = tool.read_u16_here(f_rom)
        chapter['gainedExpForExpRankDInHectorStoryHard'] = tool.read_u16_here(f_rom)
        chapter['unk5E'] = tool.read_u16_here(f_rom)
        chapter['goldForFundsRankInEliwoodStoryNormal'] = tool.read_u32_here(f_rom)
        chapter['goldForFundsRankInEliwoodStoryHard'] = tool.read_u32_here(f_rom)
        chapter['goldForFundsRankInHectorStoryNormal'] = tool.read_u32_here(f_rom)
        chapter['goldForFundsRankInHectorStoryHard'] = tool.read_u32_here(f_rom)
        chapter['chapTitleTextId'] = tool.read_u16_here(f_rom)
        chapter['chapTitleTextIdInHectorStory'] = tool.read_u16_here(f_rom)
        chapter['mapEventDataId'] = tool.read_u8_here(f_rom)
        chapter['gmapEventId'] = tool.read_u8_here(f_rom)
        chapter['divinationTextIdBeginning'] = tool.read_u16_here(f_rom)
        chapter['divinationTextIdInEliwoodStory'] = tool.read_u16_here(f_rom)
        chapter['divinationTextIdInHectorStory'] = tool.read_u16_here(f_rom)
        chapter['divinationTextIdEnding'] = tool.read_u16_here(f_rom)
        chapter['divinationPortrait'] = tool.read_u8_here(f_rom)
        chapter['divinationFee'] = tool.read_u8_here(f_rom)
        chapter['prepScreenNumber'] = tool.read_u8_here(f_rom)
        chapter['prepScreenNumberInHectorStory'] = tool.read_u8_here(f_rom)
        chapter['merchantPosX'] = tool.read_u8_here(f_rom)
        chapter['merchantPosXInHectorStory'] = tool.read_u8_here(f_rom)
        chapter['merchantPosY'] = tool.read_u8_here(f_rom)
        chapter['merchantPosYInHectorStory'] = tool.read_u8_here(f_rom)
        chapter['victorySongEnemyThreshold'] = tool.read_u8_here(f_rom)
        chapter['fadeToBlack'] = tool.read_u8_here(f_rom)
        chapter['statusObjectiveTextId'] = tool.read_u16_here(f_rom)
        chapter['goalWindowTextId'] = tool.read_u16_here(f_rom)
        chapter['goalWindowDataType'] = goal[tool.read_u8_here(f_rom)]
        chapter['goalWindowEndTurnNumber'] = tool.read_u8_here(f_rom)
        chapter['protectCharacterIndex'] = tool.read_u8_here(f_rom)
        chapter['xMarkedTile'] = tool.read_u8_here(f_rom)
        chapter['yMarkedTile'] = tool.read_u8_here(f_rom)
        chapter['unk91'] = tool.read_u8_here(f_rom)
        chapter['unk92'] = tool.read_u8_here(f_rom)
        chapter['unk93'] = tool.read_u8_here(f_rom)
        chapters.append(chapter)
    for i in range(table_entries):
        if chapters[i]['internalName'] > 0:
            f_rom.seek(chapters[i]['internalName'] - 0x8000000)
            chapters[i]['internalName'] = tool.read_ascii_here(f_rom)

out_file = open("../src/data/chapter_settings.json", "w")
json.dump({'chapters': chapters}, out_file, indent=2)
out_file.close()
